@using Microsoft.AspNetCore.Http
@model OE.Web.Areas.Institution.Models.IndexOE_InstitutionsVM

<h1 class="page-title">Institutions</h1>
<br />


@{ if (Context.Session.GetString("session_currentActiveActorTab") == "1" || Context.Session.GetString("session_currentActiveActorTab") == "2" || Context.Session.GetString("session_currentActiveActorTab") == "3")
    {
        <button class="btn btn-success btn-sm " id="btnAddOE_Institutions" name="btnAddOE_Institutions" data-toggle="modal" data-target="#mdlAddOE_Institutions">
            <span class="glyphicon glyphicon-plus" style="vertical-align:middle;margin-top: -5px"></span>
            New
        </button>
    }
    else
    {

    }
}

@{ if (Context.Session.GetString("session_currentActiveActorTab") == "1" || Context.Session.GetString("session_currentActiveActorTab") == "2" || Context.Session.GetString("session_currentActiveActorTab") == "3")
    {
        <div class="col-12 col-sm-6 col-md-3 pull-right">
            <form asp-area="Institution" asp-controller="OE_Institutions" asp-action="OE_Institutions" method="get">
                @{
                    List<SelectListItem> listItem = new List<SelectListItem>();
                    listItem.Add(new SelectListItem { Text = "View All", Value = "0" });
                    listItem.Add(new SelectListItem { Text = "Licensed Institute", Value = "1" });
                    listItem.Add(new SelectListItem { Text = "Non Licensed Institute", Value = "2" });
                    listItem.Add(new SelectListItem { Text = "Ascending Order", Value = "3" });
                    listItem.Add(new SelectListItem { Text = "Descending Order", Value = "4" });
                }
                @Html.DropDownList("ddlLicensesId", new SelectList(listItem, "Value", "Text"), null, new { @class = "form-control", onchange = "this.form.submit();" })
            </form>
        </div>
    }
    else { }
}


<br />
<br />

<div class="table-responsive">

    <table class="table table-bordered table-hover">
        <thead>
            <tr>
                <th> Institutions Name </th>
                <th> Country Name </th>
                <th> Is License </th>

                <th> Logo </th>
                <th> Favicon </th>
                <th> Contact No </th>
                <th> Email </th>
                <th>Is Active</th>

                <th>Action </th>
            </tr>
        </thead>
        <tbody>

            @foreach (var data in Model._OE_InstitutionsList)
            {
                <tr>
                    <td class="showDetails pointer">@data.Name</td>
                    <td class="showDetails pointer">@data.CountryName</td>

                    <td class="showDetails pointer">
                        @foreach (var license in Model.licenses)
                        {
                            if (license == data.Id)
                            {
                                <input type="checkbox" id="IsLicense" name="IsLicense" value="true" disabled checked="checked" />
                            }
                        }
                    </td>

                    <td class="showDetails pointer"><img src="~/@data.LogoPath" alt="Logo" width="100" /></td>
                    <td class="showDetails pointer"><img src="~/@data.FaviconPath" alt="Logo" width="20" /></td>

                    <td class="showDetails pointer">@data.ContactNo</td>

                    <td class="showDetails pointer">@data.Email</td>

                    <td class="showDetails pointer">
                        <input type="checkbox" disabled id="IsActive" name="IsActive" value="@data.IsActive" @(data.IsActive == true ? "checked=\"checked\"" : "") />
                    <td>

                    <td>


                        <button class="btn btn-primary btn-sm" id="btnEdit" name="btnEdit" data-toggle="modal" data-target="#modalEdit"
                                data-id="@data.Id"
                                data-name="@data.Name"
                                data-countryid="@data.CountryId"
                                data-logopath="@data.LogoPath"
                                data-faviconpath="@data.FaviconPath"
                                data-contact="@data.ContactNo"
                                data-email="@data.Email"
                                data-isactive="@data.IsActive">

                            <span class="glyphicon glyphicon-edit" style="vertical-align:middle;margin-top: -5px"></span>
                            Edit
                        </button>
                        @{


                            //[BR:user can not able to delete licensed institutions ]
                            if (data.DataType == "FIXED" || data.IsActive == true)
                            {
                                <button class="btn btn-danger btn-sm" disabled id="btnDelete" name="btnDelete" data-id="@data.Id">
                                    <span class="glyphicon glyphicon-trash" style="vertical-align:middle;margin-top: -5px"></span>
                                    Delete
                                </button>
                            }
                            else if (Context.Session.GetString("session_currentActiveActorTab") == "2" || Context.Session.GetString("session_currentActiveActorTab") == "3" || Context.Session.GetString("session_currentActiveActorTab") == "11")
                            {

                            }
                            else
                            {
                                <button class="btn btn-danger btn-sm " id="btnDelete" name="btnDelete" data-toggle="modal" data-target="#modalDelete" data-id="@data.Id">
                                    <span class="glyphicon glyphicon-trash" style="vertical-align:middle;margin-top: -5px"></span>
                                    Delete
                                </button>
                            }

                        }
                    </td>
                </tr>
            }

        </tbody>
    </table>

</div>

<!-- #region "All Modals" -->
<div id="mdlAddOE_Institutions" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h3>Add Institutions</h3>
            </div>
            <div class="modal-body">
                <form enctype="multipart/form-data">

                    <label>Select Country Name:</label>

                    <select class="form-control"
                            id="CountryId"
                            asp-for-id="CountryId"
                            name="OE_Institution.CountryId"
                            asp-items="@(new SelectList (ViewBag.ddlCountries, "Id","Name"))"></select>

                    <label>Name</label>

                    <input type="text" name="OE_Institution.Name" required class="form-control">

                    <label>Logo</label>

                    <input type="file"
                           name="logo"
                           id="fleLogoPath"
                           class="form-control">

                    <img id="logo" alt="Logo" width="100" style="display:none" />
                    <br />
                    <label>Favicon</label>
                    <br />

                    <input type="file"
                           name="favicon" id="fleFaviconPath" class="form-control">


                    <br />
                    <img id="favicon" alt="Favicon" width="20" style="display:none" />
                    <br />
                    <label>Email</label>

                    <input type="text" name="OE_Institution.Email" required class="form-control">

                    <label>Contact</label>

                    <input type="text" name="OE_Institution.ContactNo" id="txtContact" required class="form-control">

                    <label>
                        <input type="checkbox" name="OE_Institution.IsActive" id="addIsActive" value="true" checked="checked">
                        Is Active
                    </label>

                    <hr />

                    <button class="btn btn-success btn-md" formmethod="post"
                            asp-controller="OE_Institutions"
                            asp-action="AddInstitution">

                        <span class="glyphicon glyphicon-ok" style="vertical-align:middle;margin-top: -5px"></span>
                        Save
                    </button>
                    <button class="btn btn-danger btn-md " data-dismiss="modal">
                        <span class="glyphicon glyphicon-remove" style="vertical-align:middle; margin-top: -5px"></span>
                        Cancel
                    </button>

                </form>

            </div>

        </div>

    </div>
</div>

<div id="modalEdit" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Edit Institutions</h4>
            </div>
            <div class="modal-body">

                <form role="form" enctype="multipart/form-data">
                    <input type="hidden" name="OE_Institution.Id" id="editOE_InstitutionsId">
                    <label>Select Country:</label>
                   <select class="form-control"
                            id="EditCountryId"
                            asp-for-id="CountryId"
                            name="OE_Institution.CountryId"
                            asp-items="@(new SelectList (ViewBag.ddlCountries, "Id","Name"))"></select>

                    
                    <label> Name</label>
                    <input type="text" name="OE_Institution.Name" required id="txtEditeditOE_InstitutionsName" class="form-control">

                    <label>Logo</label>

                    <input type="file"
                           name="logo"
                           id="fleEditLogoPath"
                           class="form-control">

                    <br />
                    <img id="editlogo" name="logo" alt="Logo" width="100" style="display:none" />
                    <br />
                    <label>Favicon</label>
                    <br />

                    <input type="file"
                           name="favicon" id="fleEditFaviconPath" class="form-control">
                    <br />
                    <img id="editfavicon" name="favicon" alt="Favicon" width="20" style="display:none" />
                    <br />
                    <label>Email</label>
                    <input type="text" name="OE_Institution.Email" id="txtEditEmail" required class="form-control">
                    <label>Contact</label>
                    <input type="text" name="OE_Institution.ContactNo" id="txtEditContact" required class="form-control">
                    
                    <label>
                        <input type="checkbox" name="OE_Institution.IsActive" id="editIsActive" value="true" checked>
                        Is Active
                    </label>
                    
                    <hr />

                    <br />

                    <button class="btn btn-success btn-md"
                            formmethod="post"
                            asp-area="Institution"
                            asp-controller="OE_Institutions"
                            asp-action="EditInstitution">
                        <span class="glyphicon glyphicon-ok" style="vertical-align:middle;margin-top: -5px"></span>
                        Save
                    </button>
                    <button class="btn btn-danger btn-md " data-dismiss="modal">
                        <span class="glyphicon glyphicon-remove" style="vertical-align:middle; margin-top: -5px"></span>
                        Cancel
                    </button>

                </form>

            </div>

        </div>

    </div>
</div>

<div id="modalDelete" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times; </button>
                <h4 class="modal-title">Delete OE_Institutions</h4>
            </div>

            <div class="modal-body">
                <p><h3>Are you sure you want to delete this?</h3></p>

            </div>
            <div class="modal-footer">
                <form class="form-inline" role="form">

                    <input type="hidden" name="OE_Institution.Id" id="deleteOE_InstitutionsId">

                    <button class="btn btn-success btn-md" formmethod="post"
                            asp-controller="OE_Institutions"
                            asp-action="Delete">

                        <span class="glyphicon glyphicon-ok" style="vertical-align:middle;margin-top: -5px"></span>
                        Yes
                    </button>
                    <button class="btn btn-danger btn-md " data-dismiss="modal">
                        <span class="glyphicon glyphicon-remove" style="vertical-align:middle; margin-top: -5px"></span>
                        No
                    </button>
                </form>
            </div>

        </div>
    </div>
</div>
<!-- #endregion  "All Modals"-->
<!-- #region "All Scripts" -->
@section Scripts
    {

    <script type="text/javascript">
        $('tr td #btnEdit').on('click', function () {
            $("#editOE_InstitutionsId").val($(this).data("id"));
            $("#txtEditeditOE_InstitutionsName").val($(this).data("name"));

            $("#txtEditEmail").val($(this).data("email"));
            $("#txtEditContact").val($(this).data("contact"));
            
            $("#EditCountryId").val($(this).data("countryid"));
            
            var i = "/" + $(this).data('logopath');
            $('#editlogo').attr('src', i);


            var f = "/" + $(this).data('faviconpath');
            $('#editfavicon').attr('src', f);
            
            var ValueOfIsActive = $(this).data("isactive");

            if (ValueOfIsActive == "True") {
                $('#editIsActive').prop('checked', true);
            } else {
                $('#editIsActive').prop('checked', false);
            }
            
        });

        // [NOTE: Checked or Uncheck on Is Active of Edit form]



        $('#fleLogoPath').on('change', function () {
            var t = window.URL.createObjectURL(this.files[0]);
            $('#logo').attr('src', t);
            $('#logo').show();
        });

        $('#fleFaviconPath').on('change', function () {
            var t = window.URL.createObjectURL(this.files[0]);
            $('#favicon').attr('src', t);
            $('#favicon').show();
        });

        $('#fleEditLogoPath').on('change', function () {
            var t = window.URL.createObjectURL(this.files[0]);
            $('#editlogo').attr('src', t);

        });

        $('#fleEditFaviconPath').on('change', function () {
            var t = window.URL.createObjectURL(this.files[0]);
            $('#editfavicon').attr('src', t);

        });

        $('tr td #btnDelete').on('click', function () {
            $("#deleteOE_InstitutionsId").val($(this).data("id"));
        });






    </script>
}

<!-- #endregion  "All Scripts"-->
