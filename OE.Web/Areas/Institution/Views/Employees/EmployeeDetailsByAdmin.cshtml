@model OE.Web.Areas.Institution.Models.IndexEmployeeDetailsByAdminVM

<ol class="breadcrumb pull-left" style="background-color:transparent">
    <li><a asp-area="Institution" asp-controller="Employees" asp-action="EmployeeListByAdmin">Employees</a></li>
    <li class="active">Employee Detail</li>
</ol>

<div class="informationArea">
    <span class="label label-info "> Institution: @Model.InstitutionName </span>
</div>
<br />
<br />
<h1 class="page-title">Employee Profile</h1>

<div class="panel-group" id="accordion">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse">
                    <b>Basic Information</b>
                </a>               

                <a class="pull-right" href="#" id="basicEdit" data-viewisactive="@Model.employees.IsActive" data-employeetypeid="@Model.employees.EmployeeTypeId" data-employeecategorytypeid="@Model.employees.EmployeeCategoryTypeId">
                    <span class="glyphicon glyphicon-edit" style="vertical-align:middle;margin-top: -5px"></span>
                    Edit
                </a>
                
            </h4>
        </div>

        <div class="panel-collapse">
            <div class="panel-body">
                <div class="container">
                    <div class="row">
                        <!--#region "Basic Information View Section"-->
                        <div class="col-md-12" id="BasicViewSection">
                            <input type="hidden" name="employees.GenderId" id="viewGenderId" value="@Model.employees.GenderId" />
                            <div class="col-md-6">
                                <div class="row" style="padding:8px"> <div class="col-md-5">Employee Id:</div><div class="col-md-7">@Model.employees.Id</div></div>
                                <div class="row" style="padding:8px"> <div class="col-md-5">Full Name:</div><div class="col-md-7">@Model.employees.FirstName @Model.employees.LastName</div></div>
                                <div class="row" style="padding:8px"> <div class="col-md-5">OurEdu Id:</div><div class="col-md-7"><label style="background-color:yellow">@Model.employees.UserLoginId</label></div></div>
                                <div class="row" style="padding:8px">
                                    <div class="col-md-5">Gender:</div>
                                    <div class="col-md-7">
                                        @Model.employees.GenderName
                                    </div>
                                </div>
                                <div class="row" style="padding:8px"> <div class="col-md-5">Date Of Birth:</div><div class="col-md-7">@Model.employees.DOB.ToShortDateString()</div></div>
                                <div class="row" style="padding:8px"> <div class="col-md-5">Email:</div><div class="col-md-7">@Model.employees.EmailAddress</div></div>
                                <div class="row" style="padding:8px"> <div class="col-md-5">Contact No:</div><div class="col-md-7">@Model.employees.ContactNo</div></div>
                                <div class="row" style="padding:8px"> <div class="col-md-5">Present Address:</div><div class="col-md-7">@Model.employees.PresentAddress</div></div>
                                <div class="row" style="padding:8px"> <div class="col-md-5">Permanent Address:</div><div class="col-md-7">@Model.employees.PermanentAddress</div></div>
                                <div class="row" style="padding:8px"> <div class="col-md-5">Joining Date:</div><div class="col-md-7">@Model.employees.JoiningDate.ToShortDateString()</div></div>

                                <div class="row" style="padding:8px"> <div class="col-md-5">Designation:</div><div class="col-md-7">@Model.employees.EmployeeTypeName  @(Model.employees.EmployeeCategoryTypeName != null ? "(" + Model.employees.EmployeeCategoryTypeName + ")" : "")</div></div>

                                <div class="row" style="padding:8px">
                                    <div class="col-md-5"> Is Active:</div>
                                    <div class="col-md-7">
                                        <input type="checkbox" disabled id="ViewIsActive" name="employees.IsActive" value="@Model.employees.IsActive" @(Model.employees.IsActive == true ? "checked=\"checked\"" : "") />
                                    </div>
                                </div>


                            </div>

                            @if (String.IsNullOrEmpty(@Model.employees.IP300X200))
                            {
                                switch (Model.employees.GenderId)
                                {
                                    case 1:
                                        <div class="col-md-6"><br /><br /><img class="img-rounded" src="~/DataDictionary/images/defaultImages/GenderMale.png" alt="Image missing" style="width:250px; height:290px;" /></div>
                                        break;
                                    case 2:
                                        <div class="col-md-6"><br /><br /><img class="img-rounded" src="~/DataDictionary/images/defaultImages/GenderFemale.png" alt="Image missing" style="width:250px; height:290px;" /></div>
                                        break;
                                    case 3:
                                        <div class="col-md-6"><br /><br /><img class="img-rounded" src="~/DataDictionary/images/defaultImages/GenderThird.png" alt="Image missing" style="width:250px; height:290px;" /></div>
                                        break;
                                }
                            }
                            else
                            {
                                <div class="col-md-6"><br /><br /><img class="img-rounded" src="~/@Model.employees.IP300X200" alt="Image missing" Style="width:250px; height:290px;" /></div>
                            }


                        </div>
                        <!--#endregion "Basic Information View Section"-->
                        <!--#region "Basic Information Update Form Section"-->

                        <form method="post" enctype="multipart/form-data" id="basicEditForm">

                            <div class="col-md-12" id="BasicEditSection" style="display:none">
                                <div class="col-md-6">
                                    <div class="row" style="padding:2px">
                                        <input class="form-control" type="hidden" name="employees.Id" id="employees.Id" value="@Model.employees.Id" />
                                    </div>
                                    <div class="row" style="padding:2px"> <div class="col-md-5">Employee Id:</div><div class="col-md-7"><input class="form-control" type="text" name="empId" value="@Model.employees.Id" disabled /> </div></div>

                                    <div class="row" style="padding:2px">
                                        <div class="col-md-5">First Name:</div>
                                        <div class="col-md-7">
                                            <input class="form-control" type="text" name="employees.FirstName" value="@Model.employees.FirstName" />
                                        </div>
                                    </div>
                                    <div class="row" style="padding:2px">
                                        <div class="col-md-5">Last Name:</div>
                                        <div class="col-md-7">
                                            <input class="form-control" type="text" name="employees.LastName" value="@Model.employees.LastName" />
                                        </div>
                                    </div>

                                    <div class="row" style="padding:2px">
                                        <div class="col-md-5">OurEdu Id:</div>
                                        <div class="col-md-7">
                                            <input class="form-control" type="text" name="employees.UserLoginId" value="@Model.employees.UserLoginId" />
                                        </div>
                                    </div>


                                    <div class="row" style="padding:2px">
                                        <div class="col-md-5">Gender:</div>
                                        <div class="col-md-7">
                                            <select class="form-control" id="ddlEditGenderId" name="Employees.GenderId" asp-items="@(new SelectList(ViewBag.ddlGender, "Id","Name"))"></select>
                                        </div>
                                    </div>

                                    <div class="row" style="padding:2px"> <div class="col-md-5">Date Of Birth:</div><div class="col-md-7"><input class="form-control datetime" type="text" name="employees.DOB" value="@Model.employees.DOB.ToShortDateString()" id="editDOB" /></div></div>
                                    <div class="row" style="padding:2px"> <div class="col-md-5">Email:</div><div class="col-md-7"><input class="form-control" type="text" name="employees.EmailAddress" value="@Model.employees.EmailAddress" /></div></div>
                                    <div class="row" style="padding:2px"> <div class="col-md-5">Contact No:</div><div class="col-md-7"><input class="form-control" type="text" name="employees.ContactNo" value="@Model.employees.ContactNo" /></div></div>
                                    <div class="row" style="padding:2px"> <div class="col-md-5">Present Address:</div><div class="col-md-7"><textarea class="form-control" rows="2" name="employees.PresentAddress">@Model.employees.PresentAddress</textarea></div></div>
                                    <div class="row" style="padding:2px"> <div class="col-md-5">Permanent Address:</div><div class="col-md-7"><textarea class="form-control" rows="2" name="employees.PermanentAddress">@Model.employees.PermanentAddress</textarea></div></div>

                                    <div class="row" style="padding:2px"> <div class="col-md-5"><p style="padding-top:9px">Joining Date:</p></div><div class="col-md-7"><input class="form-control datetime" type="text" name="employees.JoiningDate" value="@Model.employees.JoiningDate.ToShortDateString()" /></div></div>
                                    
                                    <div class="row" style="padding:2px">
                                        <div class="col-md-5"><p style="padding-top:9px">Employee Type: </p></div><div class="col-md-7">
                                            <select class="form-control"
                                                    id="EmpType"
                                                    asp-for-id="Id"
                                                    name="DesignationsListVM.EmployeeTypeId"
                                                    asp-items="@(new SelectList (ViewBag.ddlEmpType,"Id","Name"))">
                                                <option value="">Select Employee Type</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row" style="padding:2px; display:none" id="designation">
                                        <div class="col-md-5"><p style="padding-top:9px">Designation: </p></div><div class="col-md-7">
                                            <select class="form-control" id="EmpCtgType" asp-for-id="Id" name="DesignationsListVM.EmployeeTypeCategoryId" asp-items="@(new SelectList(string.Empty, "Id", "Name"))"></select>
                                        </div>
                                    </div>
                                    
                                    <div class="row" style="padding:2px">
                                        <div class="col-md-5">Is Active:</div>

                                        <div class="col-md-7 ">

                                            <label class="checkbox-inline"><input type="checkbox" name="employees.IsActive" id="EditIsActive" value="true"> Enable/Disable Employee</label>
                                            <label>
                                                <a tabindex="0" data-toggle="popover" data-trigger="focus" data-container="body" title="Tip: IsActive what will do?" data-content="Active employee will be listed as current employee. Inactive employee will be listed as archived employee.">
                                                    <span class="glyphicon glyphicon-info-sign" style="top:5px; font-size:larger"></span>
                                                </a>
                                            </label>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-md-6">
                                    <br /><br />
                                    @if (String.IsNullOrEmpty(Model.employees.IP300X200))
                                    {
                                        switch (Model.employees.GenderId)
                                        {
                                            case 1:
                                                <img id="empImage" class="img-rounded" src="~/DataDictionary/images/defaultImages/GenderMale.png" alt="Image missing" style="width:250px; height:290px;" />
                                                break;
                                            case 2:
                                                <img id="empImage" class="img-rounded" src="~/DataDictionary/images/defaultImages/GenderFemale.png" alt="Image missing" style="width:250px; height:290px;" />
                                                break;
                                            case 3:
                                                <img id="empImage" class="img-rounded" src="~/DataDictionary/images/defaultImages/GenderThird.png" alt="Image missing" style="width:250px; height:290px;" />
                                                break;
                                        }
                                    }
                                    else
                                    {
                                        <img id="empImage" class="img-rounded" src="~/@Model.employees.IP300X200" asp-append-version="true" alt="Image missing" Style="width:250px; height:290px;" /><br />
                                    }

                                    <input type="file"
                                           onchange="document.getElementById('empImage').src = window.URL.createObjectURL(this.files[0])"
                                           name="ProfileImage">

                                </div>
                                <div class="col-md-12 center-block">
                                    <div class="col-md-6">
                                    </div>
                                    <div class="col-md-6">

                                        <button type="button" class="btn btn-success"
                                                id="btnEditSave">
                                            <span class="glyphicon glyphicon-save"></span>
                                            Save
                                        </button>


                                        <button class="btn btn-danger @(Model.employees.IP300X200 == null ? "hide" : "")"
                                                asp-area="Institution"
                                                asp-controller="Employees"
                                                formmethod="post"
                                                asp-action="DeleteStaticFile" asp-route-empId="@Model.employees.Id" asp-route-flagValue="1">
                                            <span class="glyphicon glyphicon-trash"></span> Remove Image
                                        </button>
                                        <a class="btn btn-danger" style="padding:5px" id="basicCancel"><span class="glyphicon glyphicon-remove"></span> Cancel</a>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <!--#endregion "Basic Information Add Form Section"-->
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<div class="modal fade" id="MessageBox" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title text-center" id="exampleModalLongTitle">Message</h3>
            </div>
            <div class="modal-body text-center text-danger">

                <h3 id="msg"></h3>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- #region "All Scripts" -->

@section Scripts
    {
    <script type="text/javascript">

        $('.datetime').datepicker({
            format: "dd/MM/yyyy",
            autoclose: true
        });

        //#region "JS for BasicInformation's Edit and Cancel buttons"
        $('#basicEdit').on('click', function () {
            
            var empTypeId = $(this).data("employeetypeid");
            $("#EmpType").val(empTypeId);
            var empCategoryTypeId = $(this).data("employeecategorytypeid");
            if (empCategoryTypeId > 0) {
            //Sending ajax request to fetch specific designation based on employeetypeid.

            var url1 = '@Url.Action("DropDown_EmployeeCategoryTypes", "Employees", new { Area = "Institution" })';
                $.getJSON(url1, { id: empTypeId }, function (jsonResult) {
                    if (jsonResult.length != 0) {
                        var item = "<option value=0>Select Designation</option>";
                        $('#EmpCtgType').empty();
                        $.each(jsonResult, function (i, row) {
                            if (row.value == empCategoryTypeId) {
                                item += "<option value='" + row.value + "' selected='selected'>" + row.text + "</option>";
                            } else
                            item += "<option value='" + row.value + "'>" + row.text + "</option>";
                        });
                        $("#EmpCtgType").html(item);
                    }
                    $('#designation').show();
                });
            }
                        
            $("#ddlEditGenderId").val($('#viewGenderId').val());
            $('#BasicViewSection').hide();
            $('#BasicEditSection').show();

            var ValueOfIsActive = $(this).data("viewisactive");
            if (ValueOfIsActive == "True") {
                $('#EditIsActive').prop('checked', true);
            } else {

                $('#EditIsActive').prop('checked', false);
            }aaa

        });

        $('#basicCancel').on('click', function () {
            $('#BasicEditSection').hide();
            $('#BasicViewSection').show();
        });
        //#endregion "JS for BasicInformation's Edit and Cancel buttons"


        //#region "JS for DynamicField's Edit and Cancel buttons"
        var flag = 0;
        $("#test #lnkEdit").on('click', function () {
            if (flag == 0) {
                $(this).siblings('p').hide();
                $(this).hide();
                $(this).siblings('form').show();
                flag = 1;
            } else alert("Please close opened input field first.");
        });

        $("#test #lnkCancel").on('click', function () {
            $("#test form").hide();
            $("#test p").show();
            $("#test button").show();
            flag = 0;
        });
        //#endregion "JS for DynamicField's Edit and Cancel buttons"

        //#region "JS for DynamicField's Add and Cancel buttons"
        $('#addSection #btnAdd').on('click', function () {
            if (flag == 0) {
                $(this).siblings('p').hide();
                $(this).siblings('form').show();
                $(this).hide();
                flag = 1;
            } else alert("Please close opened input field first.");
        });
        $('#addSection #btnCancel').on('click', function () {
            $("#addSection #btnAdd").show();
            $("#addSection p").show();
            $("#addSection form").hide();
            flag = 0;
        });

        $("#btnEditSave").on('click', function () {

            var formData = new FormData($("#basicEditForm")[0]);

                $.ajax({
                    type: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,


                    url: '@Url.Action("UpdateEmployeeDetailsByAdmin", "Employees", new { Area = "Institution" })',
                    success: function (data) {
                        if (data != null) {
                            if (data.errorMessage == null) {
                                location.reload();
                            } else {
                                $('#msg').text(data.errorMessage);
                                $('#MessageBox').modal();
                            }
                        }
                    }
                });
        });

                $('[data-toggle="popover"]').popover({
            trigger: 'focus'
                })

         $("#EmpType").on('change', function () {
        var url = '@Url.Action("DropDown_EmployeeCategoryTypes", "Employees", new { Area = "Institution" })';
        var empTypeId = $('#EmpType').val();
        $.getJSON(url, { id: empTypeId }, function (jsonResult) {
            if (jsonResult.length > 0) {
            var item = "<option value=0>Select Designation</option>";
                $("#EmpCtgType").empty();
                $.each(jsonResult, function (i, row) {
                    item += "<option value='" + row.value + "'>" + row.text + "</option>";
                });
                $('#EmpCtgType').html(item);
                $("#designation").show();
            } else {
                $("#EmpCtgType").empty();
                $("#designation").hide();
            }
        })
        });

    //#endregion "JS for DynamicField's Add and Cancel buttons"
    </script>
}

<!-- #endregion  "All Scripts"-->
